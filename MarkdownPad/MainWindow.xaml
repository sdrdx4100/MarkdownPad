<Window x:Class="MarkdownPad.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MarkdownPad"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        mc:Ignorable="d"
        Title="MarkdownPad - 無題" 
        Height="700" 
        Width="1200"
        MinHeight="400"
        MinWidth="600"
        WindowStartupLocation="CenterScreen"
        Closing="Window_Closing">
    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Control" Command="{Binding NewCommand}" />
        <KeyBinding Key="O" Modifiers="Control" Command="{Binding OpenCommand}" />
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding SaveCommand}" />
        <KeyBinding Key="S" Modifiers="Control+Shift" Command="{Binding SaveAsCommand}" />
        <KeyBinding Key="Z" Modifiers="Control" Command="{Binding UndoCommand}" />
        <KeyBinding Key="Y" Modifiers="Control" Command="{Binding RedoCommand}" />
        <KeyBinding Key="X" Modifiers="Control" Command="{Binding CutCommand}" />
        <KeyBinding Key="C" Modifiers="Control" Command="{Binding CopyCommand}" />
        <KeyBinding Key="V" Modifiers="Control" Command="{Binding PasteCommand}" />
        <KeyBinding Key="A" Modifiers="Control" Command="{Binding SelectAllCommand}" />
        <KeyBinding Key="F" Modifiers="Control" Command="{Binding FindCommand}" />
        <KeyBinding Key="H" Modifiers="Control" Command="{Binding ReplaceCommand}" />
    </Window.InputBindings>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#F5F5F5">
            <MenuItem Header="ファイル(_F)">
                <MenuItem Header="新規作成(_N)" Command="{Binding NewCommand}" InputGestureText="Ctrl+N" />
                <MenuItem Header="開く(_O)..." Command="{Binding OpenCommand}" InputGestureText="Ctrl+O" />
                <Separator />
                <MenuItem Header="保存(_S)" Command="{Binding SaveCommand}" InputGestureText="Ctrl+S" />
                <MenuItem Header="名前を付けて保存(_A)..." Command="{Binding SaveAsCommand}" InputGestureText="Ctrl+Shift+S" />
                <Separator />
                <MenuItem Header="終了(_X)" Command="{Binding ExitCommand}" />
            </MenuItem>
            <MenuItem Header="編集(_E)">
                <MenuItem Header="元に戻す(_U)" Command="{Binding UndoCommand}" InputGestureText="Ctrl+Z" />
                <MenuItem Header="やり直し(_R)" Command="{Binding RedoCommand}" InputGestureText="Ctrl+Y" />
                <Separator />
                <MenuItem Header="切り取り(_T)" Command="{Binding CutCommand}" InputGestureText="Ctrl+X" />
                <MenuItem Header="コピー(_C)" Command="{Binding CopyCommand}" InputGestureText="Ctrl+C" />
                <MenuItem Header="貼り付け(_P)" Command="{Binding PasteCommand}" InputGestureText="Ctrl+V" />
                <Separator />
                <MenuItem Header="すべて選択(_A)" Command="{Binding SelectAllCommand}" InputGestureText="Ctrl+A" />
                <Separator />
                <MenuItem Header="検索(_F)..." Command="{Binding FindCommand}" InputGestureText="Ctrl+F" />
                <MenuItem Header="置換(_H)..." Command="{Binding ReplaceCommand}" InputGestureText="Ctrl+H" />
            </MenuItem>
            <MenuItem Header="表示(_V)">
                <MenuItem Header="プレビューを表示(_P)" IsCheckable="True" IsChecked="{Binding IsPreviewVisible}" />
                <MenuItem Header="行番号を表示(_L)" IsCheckable="True" IsChecked="{Binding ShowLineNumbers}" />
                <Separator />
                <MenuItem Header="ワードラップ(_W)" IsCheckable="True" IsChecked="{Binding WordWrap}" />
            </MenuItem>
            <MenuItem Header="挿入(_I)">
                <MenuItem Header="画像を挿入(_I)..." Command="{Binding InsertImageCommand}" />
                <MenuItem Header="リンクを挿入(_L)..." Command="{Binding InsertLinkCommand}" />
                <Separator />
                <MenuItem Header="見出し1" Command="{Binding InsertHeading1Command}" />
                <MenuItem Header="見出し2" Command="{Binding InsertHeading2Command}" />
                <MenuItem Header="見出し3" Command="{Binding InsertHeading3Command}" />
                <Separator />
                <MenuItem Header="太字(_B)" Command="{Binding InsertBoldCommand}" InputGestureText="Ctrl+B" />
                <MenuItem Header="斜体(_I)" Command="{Binding InsertItalicCommand}" InputGestureText="Ctrl+I" />
                <MenuItem Header="コードブロック(_C)" Command="{Binding InsertCodeBlockCommand}" />
                <Separator />
                <MenuItem Header="箇条書き(_U)" Command="{Binding InsertBulletListCommand}" />
                <MenuItem Header="番号付きリスト(_O)" Command="{Binding InsertNumberedListCommand}" />
            </MenuItem>
            <MenuItem Header="ヘルプ(_H)">
                <MenuItem Header="マークダウンガイド(_M)" Command="{Binding MarkdownGuideCommand}" />
                <MenuItem Header="バージョン情報(_A)" Command="{Binding AboutCommand}" />
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <ToolBar Grid.Row="1" Background="#FAFAFA">
            <Button Command="{Binding NewCommand}" ToolTip="新規作成 (Ctrl+N)" Padding="8,4">
                <TextBlock Text="📄" FontSize="16" />
            </Button>
            <Button Command="{Binding OpenCommand}" ToolTip="開く (Ctrl+O)" Padding="8,4">
                <TextBlock Text="📂" FontSize="16" />
            </Button>
            <Button Command="{Binding SaveCommand}" ToolTip="保存 (Ctrl+S)" Padding="8,4">
                <TextBlock Text="💾" FontSize="16" />
            </Button>
            <Separator />
            <Button Command="{Binding UndoCommand}" ToolTip="元に戻す (Ctrl+Z)" Padding="8,4">
                <TextBlock Text="↩️" FontSize="16" />
            </Button>
            <Button Command="{Binding RedoCommand}" ToolTip="やり直し (Ctrl+Y)" Padding="8,4">
                <TextBlock Text="↪️" FontSize="16" />
            </Button>
            <Separator />
            <Button Command="{Binding CutCommand}" ToolTip="切り取り (Ctrl+X)" Padding="8,4">
                <TextBlock Text="✂️" FontSize="16" />
            </Button>
            <Button Command="{Binding CopyCommand}" ToolTip="コピー (Ctrl+C)" Padding="8,4">
                <TextBlock Text="📋" FontSize="16" />
            </Button>
            <Button Command="{Binding PasteCommand}" ToolTip="貼り付け (Ctrl+V)" Padding="8,4">
                <TextBlock Text="📎" FontSize="16" />
            </Button>
            <Separator />
            <Button Command="{Binding InsertBoldCommand}" ToolTip="太字 (Ctrl+B)" Padding="8,4">
                <TextBlock Text="B" FontWeight="Bold" FontSize="14" />
            </Button>
            <Button Command="{Binding InsertItalicCommand}" ToolTip="斜体 (Ctrl+I)" Padding="8,4">
                <TextBlock Text="I" FontStyle="Italic" FontSize="14" />
            </Button>
            <Button Command="{Binding InsertCodeBlockCommand}" ToolTip="コードブロック" Padding="8,4">
                <TextBlock Text="&lt;/&gt;" FontFamily="Consolas" FontSize="12" />
            </Button>
            <Separator />
            <Button Command="{Binding InsertImageCommand}" ToolTip="画像を挿入" Padding="8,4">
                <TextBlock Text="🖼️" FontSize="16" />
            </Button>
            <Button Command="{Binding InsertLinkCommand}" ToolTip="リンクを挿入" Padding="8,4">
                <TextBlock Text="🔗" FontSize="16" />
            </Button>
            <Separator />
            <ToggleButton IsChecked="{Binding IsPreviewVisible}" ToolTip="プレビューを表示/非表示" Padding="8,4">
                <TextBlock Text="👁️" FontSize="16" />
            </ToggleButton>
        </ToolBar>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="200" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" MinWidth="200" x:Name="PreviewColumn" />
            </Grid.ColumnDefinitions>

            <!-- Editor Panel -->
            <Border Grid.Column="0" BorderBrush="#E0E0E0" BorderThickness="1" Margin="4">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Border Grid.Row="0" Background="#F0F0F0" Padding="8,4">
                        <TextBlock Text="エディター" FontWeight="SemiBold" Foreground="#333" />
                    </Border>
                    <TextBox x:Name="EditorTextBox"
                             Grid.Row="1"
                             AcceptsReturn="True"
                             AcceptsTab="True"
                             TextWrapping="{Binding WordWrap, Converter={StaticResource BoolToWrapConverter}}"
                             FontFamily="Consolas, Meiryo"
                             FontSize="14"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto"
                             Padding="8"
                             Text="{Binding MarkdownText, UpdateSourceTrigger=PropertyChanged}"
                             TextChanged="EditorTextBox_TextChanged"
                             PreviewKeyDown="EditorTextBox_PreviewKeyDown"
                             BorderThickness="0" />
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" 
                          Width="5" 
                          HorizontalAlignment="Center" 
                          VerticalAlignment="Stretch" 
                          Background="#E0E0E0" 
                          Visibility="{Binding IsPreviewVisible, Converter={StaticResource BoolToVisibilityConverter}}" />

            <!-- Preview Panel -->
            <Border Grid.Column="2" 
                    BorderBrush="#E0E0E0" 
                    BorderThickness="1" 
                    Margin="4"
                    Visibility="{Binding IsPreviewVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Border Grid.Row="0" Background="#F0F0F0" Padding="8,4">
                        <TextBlock Text="プレビュー" FontWeight="SemiBold" Foreground="#333" />
                    </Border>
                    <wv2:WebView2 x:Name="PreviewWebView" 
                                  Grid.Row="1"
                                  DefaultBackgroundColor="White" />
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3" Background="#F5F5F5">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
            <Separator />
            <StatusBarItem>
                <TextBlock>
                    <Run Text="行: " />
                    <Run Text="{Binding CurrentLine, Mode=OneWay}" />
                    <Run Text=" 列: " />
                    <Run Text="{Binding CurrentColumn, Mode=OneWay}" />
                </TextBlock>
            </StatusBarItem>
            <Separator />
            <StatusBarItem>
                <TextBlock>
                    <Run Text="文字数: " />
                    <Run Text="{Binding CharacterCount, Mode=OneWay}" />
                </TextBlock>
            </StatusBarItem>
            <Separator />
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="{Binding EncodingName}" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
